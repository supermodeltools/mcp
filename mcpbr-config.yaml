# Supermodel MCP server configuration for mcpbr
#
# This uses the Supermodel codebase analysis MCP server.
# Requires SUPERMODEL_API_KEY environment variable.

mcp_server:
  name: "supermodel"
  command: "npx"
  args:
    - "-y"
    - "@supermodeltools/mcp-server@0.9.2"
    - "{workdir}"
    - "--precache"
  env:
    SUPERMODEL_API_KEY: "${SUPERMODEL_API_KEY}"
    SUPERMODEL_BASE_URL: "https://api.supermodeltools.com"
    SUPERMODEL_CACHE_DIR: "/tmp/supermodel-cache"
  setup_command: "npx -y @supermodeltools/mcp-server@0.9.2 precache {workdir} --output-dir /tmp/supermodel-cache"
  setup_timeout_ms: 900000

provider: "anthropic"

agent_harness: "claude-code"

model: "claude-sonnet-4-20250514"

benchmark: "swe-bench-verified"

timeout_seconds: 300

max_concurrent: 2

max_iterations: 30

agent_prompt: |
  {problem_statement}

  ## Workflow (follow this order)

  1. ORIENT: Call `overview` to see the codebase architecture. Identify which domain and files relate to the issue.
  2. LOCATE: Call `symbol_context` on 1-2 key symbols from the issue (function names, class names, error trace). Read the callers/callees to understand the change surface.
  3. STOP EXPLORING: Do not call MCP tools more than 3 times total. You now have enough context. Use Read/Grep only for targeted verification.
  4. FIX: Make the minimal code change that addresses the root cause. Prefer modifying existing logic over adding new code.
  5. TEST: Run the project's existing test suite to verify your fix. Use the repo's test runner (e.g., `python -m pytest <test_file>`). NEVER write standalone test scripts -- they will fail on missing dependencies. Find the relevant test file from the MCP output or with Grep, then run it.
  6. REGRESSION CHECK: Run the full related test module to ensure no regressions. If tests fail, read the failure output and iterate on your fix.

  ## Anti-patterns to avoid
  - Do NOT chase symbol after symbol (>3 MCP calls). Diminishing returns after 2 calls.
  - Do NOT write test_bug.py or test_fix.py scripts. The workspace lacks pip-installed dependencies. Use the project's own tests.
  - Do NOT spend iterations on TodoWrite planning. Act directly.
  - Do NOT create new test files, documentation, or reproduction scripts.

  The repository is located at {workdir}.
